<!-- dashboard.html -->
<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Dashboard â€” Church Management</title>
  <link rel="stylesheet" href="css/style.css" />
</head>
<body>
  <div id="header"></div>

  <div class="container">
    <main>
      <div class="card">
        <h2>Dashboard</h2>
        <p class="small">Overview of key church metrics.</p>
        <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:12;margin-top:12px">
          <div class="card">Members: <span id="membersCount">...</span></div>
          <div class="card">Upcoming Events: <span id="eventsCount">...</span></div>
          <div class="card">Donations (Total): <span id="donationTotal">...</span></div>
        </div>
      </div>
    </main>
  </div>

  <script type="module" src="js/firebase-config.js"></script>
  <script type="module" src="js/auth.js"></script>
  <script type="module">
    import { requireAuth } from './js/auth.js';
    import { renderHeader } from './js/nav.js';
    import { db } from './js/firebase-config.js';
    import { collection, onSnapshot } from "https://www.gstatic.com/firebasejs/11.9.0/firebase-firestore.js";

    (async ()=> {
      await requireAuth();
      renderHeader(document.getElementById('header'));
      // members count
      onSnapshot(collection(db,'members'), snap => { document.getElementById('membersCount').innerText = snap.size; });
      onSnapshot(collection(db,'events'), snap => { document.getElementById('eventsCount').innerText = snap.size; });
      onSnapshot(collection(db,'donations'), snap => {
        const total = snap.docs.reduce((s,d)=> s + (d.data().amount || 0), 0);
        document.getElementById('donationTotal').innerText = total.toFixed(2);
      });
    })();
  </script>
</body>
</html>
